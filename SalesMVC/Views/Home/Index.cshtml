@model SalesMVC.Models.UserViewModel

@{
    ViewBag.Title = "Sales Information";
    Layout = "~/Views/Shared/_Layout.cshtml";   
}

<header>
    <script src="~/Scripts/jquery-1.8.2.min.js" type="text/javascript"></script>
    <link href="~/Content/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css"/>
    <link href="~/Content/jquery.jqGrid/ui.jqgrid.css" rel="stylesheet" type="text/css"/>
    <script src="~/Scripts/jquery-ui-1.8.24.min.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="~/Scripts/i18n/grid.locale-en.js" type="text/javascript"></script>    
</header>

<h1 align="center" style="font-size: 24px">Sales list</h1>
@if (Model != null)
{
    <table id="jqg"></table>
    if (Model.UserRole == "Admin")
    {
         <div id="pager"></div>
         <script type="text/javascript">
             $(document).ready(function() {
                 $("#jqg").jqGrid({
                     url: '@Url.Action("GetData")',
                     datatype: "json",
                     colNames: ['Id', 'Date', 'Client', 'Good', 'Manager', 'Sum'],
                     colModel: [
                         { name: 'Id', index: 'Id', autowidth: true, sortable: true, key: true },
                         { name: 'Date', index: 'Date', autowidth: true, sortable: true, editable: true, sorttype: 'date', datefmt: 'y-m-d', editrules: { required: true, date: true }, editoptions: { dataInit: function(elem) { $(elem).datepicker({ dateFormat: "yy-mm-dd" }); } } },
                         { name: 'Client', index: 'Client', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                         { name: 'Good', index: 'Good', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                         { name: 'Manager', index: 'Manager', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                         { name: 'Sum', index: 'Sum', autowidth: true, align: "right", sortable: true, sorttype: 'number', editable: true, editrules: { required: true, number: true } }
                     ],
                     rowNum: 10,
                     rowList: [10, 20, 30],
                     loadonce: true,
                     sortname: 'Id',
                     sortorder: "desc",
                     autowidth: true,
                     pager: '#pager',
                     height: 200
                 });

                 function update(act) {
                     return {
                         closeAfterAdd: true,
                         height: 250,
                         width: 400,
                         closeAfterEdit: true,
                         reloadAfterSubmit: true,
                         drag: true,
                         onclickSubmit: function(params) {
                             var list = $("#jqg");
                             var selectedRow = list.getGridParam("selrow");
                             var rowData = list.getRowData(selectedRow);
                             if (act === "add")
                                 params.url = '@Url.Action("Create")';
                             else if (act === "del")
                                 params.url = '@Url.Action("Delete")';
                             else if (act === "edit")
                                 params.url = '@Url.Action("Edit")';
                         },
                         afterSubmit: function(response, postdata) {
                             $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                             return [true, "", 0];
                         }
                     };
                 }

                 $("#jqg").jqGrid('navGrid', '#pager', {
                         search: true,
                         searchtext: "Search",
                         refresh: false,
                         add: true,
                         del: true,
                         edit: true,
                         view: true,
                         viewtext: "View",
                         viewtitle: "Selected record",
                         addtext: "Add",
                         edittext: "Edit",
                         deltext: "Remove"
                     },
                     update("edit"),
                     update("add"),
                     update("del")
                 );
             });
         </script>
    }
    else
    {
        {
            <div id="pager"></div>
            <script type="text/javascript">
                $(document).ready(function () {
                    $("#jqg").jqGrid({
                        url: '@Url.Action("GetData")',
                        datatype: "json",
                        colNames: ['Id', 'Date', 'Client', 'Good', 'Manager', 'Sum'],
                        colModel: [
                            { name: 'Id', index: 'Id', autowidth: true, sortable: true, key: true },
                            { name: 'Date', index: 'Date', autowidth: true, sortable: true, editable: true, sorttype: 'date', datefmt: 'y-m-d', editrules: { required: true, date: true }, editoptions: { dataInit: function (elem) { $(elem).datepicker({ dateFormat: "yy-mm-dd" }); } } },
                            { name: 'Client', index: 'Client', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                            { name: 'Good', index: 'Good', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                            { name: 'Manager', index: 'Manager', autowidth: true, sortable: true, editable: true, editrules: { required: true } },
                            { name: 'Sum', index: 'Sum', autowidth: true, align: "right", sortable: true, sorttype: 'number', editable: true, editrules: { required: true, number: true } }
                        ],
                        rowNum: 10,
                        rowList: [10, 20, 30],
                        loadonce: true,
                        sortname: 'Id',
                        sortorder: "desc",
                        autowidth: true,
                        pager: '#pager',
                        height: 200
                    });

                    function update(act) {
                        return {
                            closeAfterAdd: true,
                            height: 250,
                            width: 400,
                            closeAfterEdit: true,
                            reloadAfterSubmit: true,
                            drag: true,
                            onclickSubmit: function (params) {
                                var list = $("#jqg");
                                var selectedRow = list.getGridParam("selrow");
                                var rowData = list.getRowData(selectedRow);
                                if (act === "add")
                                    params.url = '@Url.Action("Create")';
                                else if (act === "del")
                                    params.url = '@Url.Action("Delete")';
                                else if (act === "edit")
                                    params.url = '@Url.Action("Edit")';
                            },
                            afterSubmit: function (response, postdata) {
                                $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                return [true, "", 0];
                            }
                        };
                    }

                    $("#jqg").jqGrid('navGrid', '#pager', {
                        search: true,
                        searchtext: "Search",
                        refresh: false,
                        add: false,
                        del: false,
                        edit: false,
                        view: true,
                        viewtext: "View",
                        viewtitle: "Selected record",
                        addtext: "Add",
                        edittext: "Edit",
                        deltext: "Remove"
                    },
                        update("edit"),
                        update("add"),
                        update("del")
                    );
                });
            </script>
        }
    }
    <div id="chart_div"></div>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load('visualization', '1.0', { 'packages': ['corechart'] });
        google.setOnLoadCallback(drawChart);

        function drawChart() {
            var options = {
                'title': 'Sales by managers',
                'width': 400,
                'height': 300
            };

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Manager');
            data.addColumn('number', 'Sum');

            $.getJSON('@Url.Action("GetSales", "Home")', null,
                function (result) {
                    $.each(result.Managers, function (index, c) {
                        data.addRow(
                            [index, c]
                        );
                    });
                    var chart = new google.visualization.PieChart(
                        document.getElementById('chart_div'));
                    chart.draw(data, options);
                });
        }
    </script>
}
else
{
  <p>You can see sales info when login.</p>
}

